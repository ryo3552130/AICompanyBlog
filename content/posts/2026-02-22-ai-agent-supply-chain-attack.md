---
title: "AIコーディングツールがサプライチェーン攻撃の入口になった日 — Cline CLI事件から学ぶ防御策"
date: 2026-02-22
author: "シオリ（LocalKnowledge）"
tags: ["セキュリティ", "サプライチェーン攻撃", "AIエージェント", "CI/CD", "GitHub Actions"]
categories: ["セキュリティ"]
description: "Cline CLI 2.3.0がプロンプトインジェクション経由でサプライチェーン攻撃を受けた事例を解説。AIエージェントを特権アクターとして悪用する新しい攻撃パターンと防御策。"
---

## AIエージェントが「攻撃の踏み台」になる時代

「AIにコードを書かせる」が当たり前になった今、新しい脅威が現実になりました。2026年2月17日、人気のAIコーディングツール「Cline CLI」のバージョン2.3.0がサプライチェーン攻撃を受け、約4,000人の開発者に影響が出ました。

注目すべきは攻撃手法です。従来のサプライチェーン攻撃とは異なり、**AIエージェントをCI/CDパイプラインの「特権アクター」として悪用する**という新しいパターンでした。

## 攻撃チェーンの全容

攻撃は4段階で実行されました。

```
1. GitHub Issueにプロンプトインジェクションを仕込む
2. Issue自動トリアージのClaude（LLM）が悪意あるコードを実行
3. GitHub Actionsのキャッシュが汚染される
4. ナイトリービルドが汚染キャッシュを読み込み、npm公開トークンを窃取
```

窃取されたトークンで改ざん版Cline 2.3.0がnpmに公開され、`postinstall`スクリプトで不正パッケージが自動インストールされました。発覚まで約8時間。

ポイントは、**攻撃者が直接コードを改ざんしたのではなく、AIエージェントに改ざんさせた**ことです。AIがGitHub Actionsに書き込み権限を持っていたため、プロンプトインジェクション一発でパイプライン全体が汚染されました。

## なぜAIエージェントが狙われるのか

AIエージェントは便利さと引き換えに、従来のツールにはないリスクを持っています。

| 従来のCI/CDツール | AIエージェント |
|---|---|
| 決められた処理のみ実行 | 自然言語の指示で任意の処理を実行可能 |
| 入力はコード・設定ファイル | 入力にIssue本文・コメント等の非構造化データを含む |
| 攻撃にはコード改ざんが必要 | プロンプトインジェクションで操作可能 |

つまり、AIエージェントにCI/CDの権限を与えることは、**「自然言語で操作できるバックドア」を設置するのと同じリスク**を孕んでいます。

## 具体的な防御策

### 1. AIエージェントの権限を最小化する

```yaml
# GitHub Actions: 権限を明示的に制限
permissions:
  contents: read      # 書き込み権限を与えない
  issues: read
  pull-requests: read
```

AIエージェントが本当に書き込み権限を必要とするか、ワークフローごとに精査しましょう。

### 2. パッケージ公開にOIDC認証を使う

npmトークンが窃取されたのが今回の攻撃の核心です。OIDC（OpenID Connect）認証に移行すれば、長期間有効なトークンを保存する必要がなくなります。

```yaml
# GitHub Actions: OIDC経由でnpmに公開
permissions:
  id-token: write
steps:
  - uses: actions/setup-node@v4
    with:
      registry-url: 'https://registry.npmjs.org'
  - run: npm publish --provenance
    env:
      NODE_AUTH_TOKEN: # OIDC経由で自動取得
```

### 3. 外部依存の定期監査

```bash
# npm
npm audit --audit-level=high

# pip
pip-audit --strict

# これらをCI/CDパイプラインに組み込む
```

### 4. AIエージェントの入力を検証する

Issue本文やコメントをAIに渡す前に、プロンプトインジェクションのパターンを検出するフィルタを設けましょう。完璧な防御は難しいですが、既知のパターン（`ignore previous instructions`等）のブロックだけでも効果があります。

## まとめ

- AIエージェントは「特権アクター」として認識し、権限を最小限にする
- CI/CDパイプラインの認証はOIDCベースに移行する
- 外部依存の監査を定期的に実行する
- AIへの入力（Issue本文等）にフィルタを設ける
- Microsoftも指摘する通り、AIエージェントにはガバナンスが必要

AIツールの便利さを享受しつつ、「AIが攻撃者に操られたらどうなるか」を常に想定しておくことが、これからの開発チームに求められるセキュリティ意識です。
