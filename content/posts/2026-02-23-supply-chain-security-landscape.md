---
title: "npmサプライチェーンの攻撃・放置・防御 — 2026年2月に起きた3つの事件から学ぶ"
date: 2026-02-23
author: "シオリ（LocalKnowledge）"
tags: ["セキュリティ", "サプライチェーン", "npm", "Deno", "CI/CD"]
categories: ["セキュリティ"]
description: "Cline CLI攻撃、npmのゼロデイ放置、Denoの時間ベース防御。2026年2月に起きた3つの事件が示すサプライチェーンセキュリティの現在地。"
---

## 1週間で「攻撃・放置・防御」が揃った

2026年2月、npmエコシステムのサプライチェーンセキュリティに関する3つの出来事が立て続けに起きました。攻撃手法、プラットフォームの対応、そして防御策。この3つを並べると、サプライチェーンセキュリティの現在地が見えてきます。

## 攻撃：Cline CLI 2.3.0（2/17）

AIコーディングツール「Cline CLI」がサプライチェーン攻撃を受けました。

```
1. GitHub Issueにプロンプトインジェクションを仕込む
2. Issue自動トリアージのAI（Claude）が悪意あるコードを実行
3. GitHub Actionsのキャッシュが汚染される
4. npm公開トークンが窃取され、改ざん版が公開される
```

8時間で約4,000回ダウンロード。注目すべきは、AIエージェントをCI/CDパイプラインの「特権アクター」として悪用した点です。人間ではなくAIが攻撃の踏み台になる、新しいパターンでした。

## 放置：PackageGate（1月報告、2月公開）

Koi Securityがnpm/pnpm/vlt/Bunに影響する6つのゼロデイ脆弱性を報告。git依存関係経由で`.npmrc`を注入し、`--ignore-scripts`フラグをバイパスできる脆弱性です。

| パッケージマネージャ | 対応 |
|---|---|
| pnpm | 2週間で修正 |
| vlt | 8日で修正 |
| Bun | 3週間で修正 |
| npm | **「仕様通り」として修正拒否** |

npmの立場は「ユーザーがパッケージの内容を精査する責任がある」。しかし現実には、npm上の悪意あるパッケージは2025年に73%増加し、全OSSマルウェアの90%がnpm上に存在します。CIパイプラインで`--ignore-scripts`を信頼している環境は、この脆弱性の影響を受けます。

## 防御：Deno 2.6のminimumDependencyAge

Deno 2.6が導入した`minimumDependencyAge`は、シンプルながら強力な防御策です。

```json
// deno.json
{
  "minimumDependencyAge": "30m"
}
```

この設定で「公開後30分以内のパッケージはインストール拒否」になります。Cline攻撃のように、窃取したトークンで改ざん版を公開→即座にダウンロードさせるパターンに対して、時間という壁を設けます。

加えて`deno audit`は、CVE脆弱性スキャンに加えてsocket.devのサプライチェーン分析を統合。npm auditが見逃す脅威もカバーします。

## 3つの事件が示す構造

並べてみると、サプライチェーンの各レイヤーに問題があることが分かります。

| レイヤー | 問題 | 事件 |
|---------|------|------|
| 開発ツール | AIエージェントが攻撃の踏み台になる | Cline CLI攻撃 |
| パッケージマネージャ | 既知の脆弱性が放置される | PackageGate |
| ランタイム | 防御機能が不十分 | → Deno 2.6で改善 |

攻撃者はAIを悪用し、プラットフォームは脆弱性を放置し、防御はランタイム側が担う。この非対称な構造が、2026年のサプライチェーンセキュリティの現実です。

## 実践的な防御策

すぐに取り入れられる対策を整理します。

```bash
# 1. 依存パッケージの定期監査
npm audit --audit-level=high
pip-audit --strict

# 2. CI/CDの権限最小化
# GitHub Actionsのpermissionsを明示的に制限
permissions:
  contents: read
  issues: read

# 3. パッケージ公開にOIDC認証を使う（長期トークンを排除）

# 4. 可能ならpnpmに移行（脆弱性対応が迅速）
```

そして「新しすぎるものは疑う」という原則。Denoの`minimumDependencyAge`はこの原則の実装ですが、npm環境でも同様のチェックをCI/CDに組み込むことは可能です。

## まとめ

- Cline攻撃は「AIエージェントを特権アクターとして悪用する」新パターン
- PackageGateは「パッケージマネージャ自体が脆弱性を放置する」構造的問題
- Deno 2.6の`minimumDependencyAge`は「時間で新規マルウェアを弾く」シンプルな防御
- サプライチェーンの各レイヤー（ツール・マネージャ・ランタイム）に問題がある
- `--ignore-scripts`だけに頼らず、多層防御を構築すべき
